
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Predicting Daily Curtailment Events &#8212; California Renewable Curtailments  documentation</title>
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>California Renewable Curtailments  documentation</span></a></h1>
        <h2 class="heading"><span>Predicting Daily Curtailment Events</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Predicting-Daily-Curtailment-Events">
<h1>Predicting Daily Curtailment Events<a class="headerlink" href="#Predicting-Daily-Curtailment-Events" title="Permalink to this headline">¶</a></h1>
<p>Process Overview:</p>
<ol class="arabic simple">
<li><p>Label curtailment events (i.e. define a decision boundary)</p></li>
<li><p>Partition historic data into training and test sets</p>
<ol class="arabic simple">
<li><p>Spring Season (March-May)</p></li>
<li><p>TODO: Fall season</p></li>
</ol>
</li>
<li><p>Fit a statistical model to the training data</p></li>
<li><p>Predict against the test data</p></li>
<li><p>Evaluate the performance of the model against known labels in the test data.</p></li>
</ol>
<p>Models: - See Below…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import pandas as pd
from dask import dataframe as dd
import statsmodels.formula.api as smf
import statsmodels.api as sm

from src.conf import settings
</pre></div>
</div>
</div>
<div class="section" id="Early-Spring">
<h2>Early Spring<a class="headerlink" href="#Early-Spring" title="Permalink to this headline">¶</a></h2>
<p>In our exploratory data analysis, we found evidence of seasonality being a strong factor in influencing curtailment intensity, being particularly noticeable in early spring. Here we exam only Feb - May curtailment to derive a model accordingly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Read curtailment data, aggregate to dailies.
df = pd.concat(
    [
        pd.read_parquet(
            settings.DATA_DIR / f&quot;processed/caiso/{y}.parquet&quot;
        ) for y in range(2017, 2020)
    ]
)

df.columns = df.columns.str.lower().str.replace(&quot; &quot;, &quot;_&quot;)
df.index = df.index.tz_convert(&quot;US/Pacific&quot;)
df = df.groupby(pd.Grouper(freq=&quot;D&quot;)).sum()
# Hourly resampling is a bad idea because hour-to-hour effects are co-correlated
# df = df[columns].groupby(pd.Grouper(freq=&quot;H&quot;)).sum()
df.reset_index(inplace=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/fastparquet/encoding.py:222: NumbaDeprecationWarning: <span class="ansi-bold">The &#39;numba.jitclass&#39; decorator has moved to &#39;numba.experimental.jitclass&#39; to better reflect the experimental nature of the functionality. Please update your imports to accommodate this change and see http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#change-of-jitclass-location for the time frame.</span>
  Numpy8 = numba.jitclass(spec8)(NumpyIO)
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/fastparquet/encoding.py:224: NumbaDeprecationWarning: <span class="ansi-bold">The &#39;numba.jitclass&#39; decorator has moved to &#39;numba.experimental.jitclass&#39; to better reflect the experimental nature of the functionality. Please update your imports to accommodate this change and see http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#change-of-jitclass-location for the time frame.</span>
  Numpy32 = numba.jitclass(spec32)(NumpyIO)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.dtypes
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
timestamp                         datetime64[ns, US/Pacific]
load                                                 float64
solar                                                float64
wind                                                 float64
net_load                                             float64
renewables                                           float64
nuclear                                              float64
large_hydro                                          float64
imports                                              float64
generation                                           float64
thermal                                              float64
load_less_(generation+imports)                       float64
wind_curtailment                                     float64
solar_curtailment                                    float64
dtype: object
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>load</th>
      <th>solar</th>
      <th>wind</th>
      <th>net_load</th>
      <th>renewables</th>
      <th>nuclear</th>
      <th>large_hydro</th>
      <th>imports</th>
      <th>generation</th>
      <th>thermal</th>
      <th>load_less_(generation+imports)</th>
      <th>wind_curtailment</th>
      <th>solar_curtailment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-01-01 00:00:00-08:00</td>
      <td>6.451973e+06</td>
      <td>502302.914737</td>
      <td>656544.662054</td>
      <td>5.293125e+06</td>
      <td>1.665067e+06</td>
      <td>652721.169749</td>
      <td>653481.452160</td>
      <td>2.200843e+06</td>
      <td>4.251096e+06</td>
      <td>1.279826e+06</td>
      <td>33.747653</td>
      <td>10107.108141</td>
      <td>26760.716117</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-01-02 00:00:00-08:00</td>
      <td>6.838524e+06</td>
      <td>203004.927518</td>
      <td>443945.262752</td>
      <td>6.191574e+06</td>
      <td>1.156723e+06</td>
      <td>653163.556261</td>
      <td>705478.766030</td>
      <td>2.372526e+06</td>
      <td>4.465951e+06</td>
      <td>1.950586e+06</td>
      <td>47.689558</td>
      <td>401.789387</td>
      <td>43.705500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-01-03 00:00:00-08:00</td>
      <td>7.391597e+06</td>
      <td>256791.945920</td>
      <td>279703.466170</td>
      <td>6.855101e+06</td>
      <td>1.053297e+06</td>
      <td>654631.092257</td>
      <td>793118.552495</td>
      <td>1.885086e+06</td>
      <td>5.506580e+06</td>
      <td>3.005534e+06</td>
      <td>-69.892993</td>
      <td>0.000000</td>
      <td>54.841500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-01-04 00:00:00-08:00</td>
      <td>7.304337e+06</td>
      <td>351737.160810</td>
      <td>339561.662186</td>
      <td>6.613038e+06</td>
      <td>1.213044e+06</td>
      <td>653906.204819</td>
      <td>779211.177282</td>
      <td>1.877239e+06</td>
      <td>5.427051e+06</td>
      <td>2.780890e+06</td>
      <td>46.565469</td>
      <td>0.000000</td>
      <td>20.247000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-01-05 00:00:00-08:00</td>
      <td>7.246891e+06</td>
      <td>343183.228333</td>
      <td>629678.639548</td>
      <td>6.274029e+06</td>
      <td>1.493144e+06</td>
      <td>653460.137940</td>
      <td>865964.297512</td>
      <td>1.239591e+06</td>
      <td>6.007303e+06</td>
      <td>2.994735e+06</td>
      <td>-3.179387</td>
      <td>804.842781</td>
      <td>191.525216</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Subset curtailments data to relevant time range
df = df[df[&quot;timestamp&quot;].dt.month.isin(range(2,6))]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Analysis Period of Dataset
df[&quot;timestamp&quot;].describe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
count                           360
unique                          360
top       2019-05-24 00:00:00-07:00
freq                              1
first     2017-02-01 00:00:00-08:00
last      2019-05-31 00:00:00-07:00
Name: timestamp, dtype: object
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Label Data - based on our EDA, we might start by &quot;guessing&quot; a threshold of importance of .05
# Later methods will be less biased, and allow for more variance.
# TODO: Try to find natural clusterings through an unsupervised process to label the dataset, and try to predict those labels.
df[&quot;curtailment_event&quot;] = pd.Categorical(df[&quot;solar_curtailment&quot;]/df[&quot;solar&quot;] &gt; .1)

df[&quot;is_weekday&quot;] = pd.Categorical(df[&quot;timestamp&quot;].dt.weekday.isin([5, 6]))
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Merge Weather Data
# Use Day-Ahead forecasts
forecasts = [
    *(settings.DATA_DIR / f&quot;interim/gfs/ca/gfs_3_201[7-9][01][2-5]*_0000_{i*3:03}.parquet&quot; for i in range(5, 10))
]
dayahead_weather = dd.read_parquet(forecasts).compute()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dayahead_weather[&quot;timestamp&quot;] = dayahead_weather[&quot;valid_time&quot;].dt.tz_localize(&quot;UTC&quot;).dt.tz_convert(&quot;US/Pacific&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dayahead_weather.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>t</th>
      <th>gust</th>
      <th>tp</th>
      <th>dswrf</th>
      <th>uswrf</th>
      <th>SUNSD</th>
      <th>al</th>
      <th>sp</th>
      <th>...</th>
      <th>MTFCC</th>
      <th>CSAFP</th>
      <th>CBSAFP</th>
      <th>METDIVFP</th>
      <th>FUNCSTAT</th>
      <th>ALAND</th>
      <th>AWATER</th>
      <th>INTPTLAT</th>
      <th>INTPTLON</th>
      <th>timestamp</th>
    </tr>
    <tr>
      <th>index</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17517</th>
      <td>42.0</td>
      <td>237.0</td>
      <td>269.899994</td>
      <td>2.9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>86861.039062</td>
      <td>...</td>
      <td>G4020</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>A</td>
      <td>16261974847</td>
      <td>179108278</td>
      <td>+41.5879861</td>
      <td>-122.5332868</td>
      <td>2017-02-01 07:00:00-08:00</td>
    </tr>
    <tr>
      <th>17518</th>
      <td>42.0</td>
      <td>238.0</td>
      <td>266.000000</td>
      <td>1.9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>86630.640625</td>
      <td>...</td>
      <td>G4020</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>A</td>
      <td>16261974847</td>
      <td>179108278</td>
      <td>+41.5879861</td>
      <td>-122.5332868</td>
      <td>2017-02-01 07:00:00-08:00</td>
    </tr>
    <tr>
      <th>17876</th>
      <td>41.0</td>
      <td>236.0</td>
      <td>278.600006</td>
      <td>2.9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>97531.437500</td>
      <td>...</td>
      <td>G4020</td>
      <td>None</td>
      <td>21700</td>
      <td>None</td>
      <td>A</td>
      <td>9240992572</td>
      <td>1254297982</td>
      <td>+40.7066731</td>
      <td>-123.9258181</td>
      <td>2017-02-01 07:00:00-08:00</td>
    </tr>
    <tr>
      <th>17877</th>
      <td>41.0</td>
      <td>237.0</td>
      <td>270.100006</td>
      <td>2.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>81915.437500</td>
      <td>...</td>
      <td>G4020</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>A</td>
      <td>8234265201</td>
      <td>73407949</td>
      <td>+40.6477241</td>
      <td>-123.1144043</td>
      <td>2017-02-01 07:00:00-08:00</td>
    </tr>
    <tr>
      <th>18237</th>
      <td>40.0</td>
      <td>237.0</td>
      <td>272.000000</td>
      <td>2.8</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>83081.843750</td>
      <td>...</td>
      <td>G4020</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>A</td>
      <td>8234265201</td>
      <td>73407949</td>
      <td>+40.6477241</td>
      <td>-123.1144043</td>
      <td>2017-02-01 07:00:00-08:00</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 37 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dayahead_weather.iloc[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
latitude                              42
longitude                            237
t                                  269.9
gust                                 2.9
tp                                     0
dswrf                                  0
uswrf                                  0
SUNSD                                  0
al                                     0
sp                                 86861
csnow                                  0
cicep                                  0
cfrzr                                  0
crain                                  0
sde                                 0.34
surface                                0
time                 2017-02-01 00:00:00
valid_time           2017-02-01 15:00:00
index_right                           54
STATEFP                               06
COUNTYFP                             093
COUNTYNS                        00277311
GEOID                              06093
NAME                            Siskiyou
NAMELSAD                 Siskiyou County
LSAD                                  06
CLASSFP                               H1
MTFCC                              G4020
CSAFP                               None
CBSAFP                              None
METDIVFP                            None
FUNCSTAT                               A
ALAND                        16261974847
AWATER                         179108278
INTPTLAT                     +41.5879861
INTPTLON                    -122.5332868
timestamp      2017-02-01 07:00:00-08:00
Name: 17517, dtype: object
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dayahead_weather.dtypes
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
latitude                          float64
longitude                         float64
t                                 float32
gust                              float32
tp                                float32
dswrf                             float32
uswrf                             float32
SUNSD                             float32
al                                float32
sp                                float32
csnow                             float32
cicep                             float32
cfrzr                             float32
crain                             float32
sde                               float32
surface                             int64
time                       datetime64[ns]
valid_time                 datetime64[ns]
index_right                         int64
STATEFP                            object
COUNTYFP                           object
COUNTYNS                           object
GEOID                              object
NAME                               object
NAMELSAD                           object
LSAD                               object
CLASSFP                            object
MTFCC                              object
CSAFP                              object
CBSAFP                             object
METDIVFP                           object
FUNCSTAT                           object
ALAND                               int64
AWATER                              int64
INTPTLAT                           object
INTPTLON                           object
timestamp      datetime64[ns, US/Pacific]
dtype: object
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Take an average over all datapoints (no weighting)
# FIXME: 100 We need to be more thoughtful about how to integrate this data.
# It should be weighted somehow, or perhaps certain locations are expressed as their own IV.
# Look into Uitlity CZs
dayahead_hourly = dayahead_weather.groupby(pd.Grouper(key=&quot;timestamp&quot;, freq=&quot;H&quot;))[[&quot;t&quot;, &quot;dswrf&quot;, &quot;uswrf&quot;, &quot;gust&quot;, &quot;SUNSD&quot;]].mean().interpolate().reset_index()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dayahead_daily = dayahead_weather.groupby(pd.Grouper(key=&quot;timestamp&quot;, freq=&quot;D&quot;)).agg({&quot;t&quot;: &quot;mean&quot;, &quot;dswrf&quot;: &quot;mean&quot;, &quot;uswrf&quot;: &quot;mean&quot;, &quot;SUNSD&quot;: &quot;sum&quot;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>data = df.merge(dayahead_daily, on=&quot;timestamp&quot;, how=&quot;inner&quot;)
data
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>load</th>
      <th>solar</th>
      <th>wind</th>
      <th>net_load</th>
      <th>renewables</th>
      <th>nuclear</th>
      <th>large_hydro</th>
      <th>imports</th>
      <th>generation</th>
      <th>thermal</th>
      <th>load_less_(generation+imports)</th>
      <th>wind_curtailment</th>
      <th>solar_curtailment</th>
      <th>curtailment_event</th>
      <th>is_weekday</th>
      <th>t</th>
      <th>dswrf</th>
      <th>uswrf</th>
      <th>SUNSD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-02-01 00:00:00-08:00</td>
      <td>7.404797e+06</td>
      <td>6.365488e+05</td>
      <td>8.839707e+04</td>
      <td>6.679851e+06</td>
      <td>1.241231e+06</td>
      <td>652218.031425</td>
      <td>1.058698e+06</td>
      <td>2.043459e+06</td>
      <td>5.361323e+06</td>
      <td>2.409176e+06</td>
      <td>14.109963</td>
      <td>64.670000</td>
      <td>8480.663464</td>
      <td>False</td>
      <td>False</td>
      <td>282.630219</td>
      <td>204.382217</td>
      <td>46.266666</td>
      <td>2130985.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-02-02 00:00:00-08:00</td>
      <td>7.367050e+06</td>
      <td>5.002730e+05</td>
      <td>2.195530e+05</td>
      <td>6.647224e+06</td>
      <td>1.235706e+06</td>
      <td>651180.678103</td>
      <td>1.077320e+06</td>
      <td>1.941564e+06</td>
      <td>5.425467e+06</td>
      <td>2.461260e+06</td>
      <td>19.334575</td>
      <td>2691.564962</td>
      <td>288.956667</td>
      <td>False</td>
      <td>False</td>
      <td>282.440430</td>
      <td>155.364441</td>
      <td>36.537777</td>
      <td>1721099.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-02-03 00:00:00-08:00</td>
      <td>7.272859e+06</td>
      <td>5.318559e+05</td>
      <td>2.889443e+05</td>
      <td>6.452059e+06</td>
      <td>1.332687e+06</td>
      <td>650538.682373</td>
      <td>1.103827e+06</td>
      <td>1.913683e+06</td>
      <td>5.359143e+06</td>
      <td>2.272091e+06</td>
      <td>32.670400</td>
      <td>488.852142</td>
      <td>869.203799</td>
      <td>False</td>
      <td>False</td>
      <td>283.654236</td>
      <td>162.995560</td>
      <td>35.911110</td>
      <td>1762346.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-02-04 00:00:00-08:00</td>
      <td>6.611103e+06</td>
      <td>6.363877e+05</td>
      <td>4.979092e+05</td>
      <td>5.476806e+06</td>
      <td>1.657910e+06</td>
      <td>649935.253088</td>
      <td>1.102862e+06</td>
      <td>1.667016e+06</td>
      <td>4.944096e+06</td>
      <td>1.533388e+06</td>
      <td>-9.417728</td>
      <td>8260.820991</td>
      <td>69858.576657</td>
      <td>True</td>
      <td>True</td>
      <td>283.166656</td>
      <td>197.639999</td>
      <td>42.088890</td>
      <td>1947685.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-02-05 00:00:00-08:00</td>
      <td>6.661248e+06</td>
      <td>4.002112e+05</td>
      <td>2.128107e+05</td>
      <td>6.048226e+06</td>
      <td>1.123362e+06</td>
      <td>649679.457890</td>
      <td>1.093060e+06</td>
      <td>2.046784e+06</td>
      <td>4.614450e+06</td>
      <td>1.748349e+06</td>
      <td>12.990172</td>
      <td>0.000000</td>
      <td>25.348000</td>
      <td>False</td>
      <td>True</td>
      <td>283.199097</td>
      <td>174.813339</td>
      <td>35.973331</td>
      <td>2019408.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>355</th>
      <td>2019-05-27 00:00:00-07:00</td>
      <td>5.672302e+06</td>
      <td>7.720765e+05</td>
      <td>1.113156e+06</td>
      <td>3.787069e+06</td>
      <td>2.453673e+06</td>
      <td>656141.389061</td>
      <td>9.970034e+05</td>
      <td>1.169736e+06</td>
      <td>4.502609e+06</td>
      <td>3.957918e+05</td>
      <td>-43.080195</td>
      <td>18796.425323</td>
      <td>444354.402287</td>
      <td>True</td>
      <td>False</td>
      <td>292.328644</td>
      <td>457.533325</td>
      <td>73.480003</td>
      <td>3091204.0</td>
    </tr>
    <tr>
      <th>356</th>
      <td>2019-05-28 00:00:00-07:00</td>
      <td>6.436942e+06</td>
      <td>1.194693e+06</td>
      <td>9.471656e+05</td>
      <td>4.295084e+06</td>
      <td>2.701523e+06</td>
      <td>656950.514763</td>
      <td>1.010069e+06</td>
      <td>1.417568e+06</td>
      <td>5.019443e+06</td>
      <td>6.509010e+05</td>
      <td>-69.383111</td>
      <td>924.968950</td>
      <td>63554.570744</td>
      <td>False</td>
      <td>False</td>
      <td>296.436951</td>
      <td>507.760010</td>
      <td>74.080002</td>
      <td>3122509.0</td>
    </tr>
    <tr>
      <th>357</th>
      <td>2019-05-29 00:00:00-07:00</td>
      <td>6.762152e+06</td>
      <td>1.239861e+06</td>
      <td>5.052720e+05</td>
      <td>5.017019e+06</td>
      <td>2.309672e+06</td>
      <td>657307.503346</td>
      <td>1.089729e+06</td>
      <td>1.752092e+06</td>
      <td>5.010103e+06</td>
      <td>9.533939e+05</td>
      <td>-42.688343</td>
      <td>10658.002569</td>
      <td>72766.329577</td>
      <td>False</td>
      <td>False</td>
      <td>299.156006</td>
      <td>511.271118</td>
      <td>73.702225</td>
      <td>3112164.0</td>
    </tr>
    <tr>
      <th>358</th>
      <td>2019-05-30 00:00:00-07:00</td>
      <td>6.865228e+06</td>
      <td>1.295425e+06</td>
      <td>5.069673e+05</td>
      <td>5.062835e+06</td>
      <td>2.359094e+06</td>
      <td>657488.225968</td>
      <td>1.192374e+06</td>
      <td>1.771105e+06</td>
      <td>5.094174e+06</td>
      <td>8.852177e+05</td>
      <td>-50.745769</td>
      <td>13743.059075</td>
      <td>7661.455448</td>
      <td>False</td>
      <td>False</td>
      <td>299.053741</td>
      <td>506.617767</td>
      <td>73.831108</td>
      <td>3118246.0</td>
    </tr>
    <tr>
      <th>359</th>
      <td>2019-05-31 00:00:00-07:00</td>
      <td>6.929919e+06</td>
      <td>1.244073e+06</td>
      <td>4.013874e+05</td>
      <td>5.284459e+06</td>
      <td>2.219221e+06</td>
      <td>657313.148060</td>
      <td>1.212114e+06</td>
      <td>1.889459e+06</td>
      <td>5.040392e+06</td>
      <td>9.517434e+05</td>
      <td>67.953527</td>
      <td>909.440812</td>
      <td>48430.745252</td>
      <td>False</td>
      <td>False</td>
      <td>298.764374</td>
      <td>538.822205</td>
      <td>76.894447</td>
      <td>2290201.0</td>
    </tr>
  </tbody>
</table>
<p>360 rows × 20 columns</p>
</div></div>
</div>
</div>
</div>
<div class="section" id="Single-Model-Run">
<h1>Single Model Run<a class="headerlink" href="#Single-Model-Run" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>test_data = data.sample(int(len(data)*.3//1))
training_data = data[~data.index.isin(test_data.index)]
model = &quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + t&quot;
result = smf.glm(
    model,
    training_data,
    family=sm.families.Binomial()
).fit()
result.summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>   <td>['C(curtailment_event)[False]', 'C(curtailment_event)[True]']</td> <th>  No. Observations:  </th>  <td>   248</td>
</tr>
<tr>
  <th>Model:</th>                                        <td>GLM</td>                              <th>  Df Residuals:      </th>  <td>   242</td>
</tr>
<tr>
  <th>Model Family:</th>                              <td>Binomial</td>                            <th>  Df Model:          </th>  <td>     5</td>
</tr>
<tr>
  <th>Link Function:</th>                               <td>logit</td>                             <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                                      <td>IRLS</td>                              <th>  Log-Likelihood:    </th> <td> -72.320</td>
</tr>
<tr>
  <th>Date:</th>                                  <td>Thu, 30 Apr 2020</td>                        <th>  Deviance:          </th> <td>  144.64</td>
</tr>
<tr>
  <th>Time:</th>                                      <td>12:32:09</td>                            <th>  Pearson chi2:      </th>  <td>  191.</td>
</tr>
<tr>
  <th>No. Iterations:</th>                                <td>6</td>                               <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>                           <td>nonrobust</td>                           <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
               <td></td>                 <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>                  <td>  -29.0311</td> <td>   17.196</td> <td>   -1.688</td> <td> 0.091</td> <td>  -62.735</td> <td>    4.673</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.3]</th> <td>    0.0594</td> <td>    0.736</td> <td>    0.081</td> <td> 0.936</td> <td>   -1.384</td> <td>    1.502</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.4]</th> <td>   -1.3746</td> <td>    0.860</td> <td>   -1.599</td> <td> 0.110</td> <td>   -3.059</td> <td>    0.310</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.5]</th> <td>   -1.6381</td> <td>    1.027</td> <td>   -1.595</td> <td> 0.111</td> <td>   -3.652</td> <td>    0.375</td>
</tr>
<tr>
  <th>C(is_weekday)[T.True]</th>      <td>   -2.4666</td> <td>    0.472</td> <td>   -5.223</td> <td> 0.000</td> <td>   -3.392</td> <td>   -1.541</td>
</tr>
<tr>
  <th>t</th>                          <td>    0.1142</td> <td>    0.061</td> <td>    1.869</td> <td> 0.062</td> <td>   -0.006</td> <td>    0.234</td>
</tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>predictions = result.predict(test_data.drop(columns=[&quot;curtailment_event&quot;]))
predictions.name = &quot;probability&quot;
predictions = test_data.merge(predictions, left_index=True, right_index=True)

cutoff = .7
true_positives = predictions.query(&quot;probability &gt; @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts().loc[True]
false_negatives = predictions.query(&quot;probability &gt; @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts().loc[False]
true_negatives = predictions.query(&quot;probability &lt;= @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts().loc[False]
false_positives = predictions.query(&quot;probability &lt;= @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts().loc[True]

accuracy = (true_positives+true_negatives)/len(predictions)
precision = true_positives / (true_positives + false_positives)
print(f&quot;Accuracy: {accuracy}; Precision: {precision}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy: 0.19444444444444445; Precision: 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>predictions[&quot;curtailment_event&quot;].astype(bool).sum()/len(predictions[&quot;curtailment_event&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.06481481481481481
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>1 - predictions[&quot;probability&quot;].mean()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.10371318777291871
</pre></div></div>
</div>
</div>
<div class="section" id="Multi-Model-Run">
<h1>Multi-Model Run<a class="headerlink" href="#Multi-Model-Run" title="Permalink to this headline">¶</a></h1>
<p>TODO:</p>
<ul class="simple">
<li><p>Try a k-fold approach instead. Divide the training set into K folds (without resampling), use k-1 folds as the training data and withold 1 fold. Run the model k times witholding the next fold. Calculate your accuracy metrics based on the witheld data as the “test” data within each folded run.</p></li>
</ul>
<p>Other Notes:</p>
<ul class="simple">
<li><p>Folding is difficult to do when predicting low-frequency events. Each fold may contain a consecutive set of rows that contain no curtailment events, effectively limiting our predictions to only consider or attempt to predict 1 type of event.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>def simulate(model, data, cutoff=.8):
    test_data = data.sample(int(len(data)*.2//1))
    training_data = data[~data.index.isin(test_data.index)]
    result = smf.glm(
        model,
        training_data,
        family=sm.families.Binomial()
    ).fit()

    predictions = result.predict(test_data.drop(columns=[&quot;curtailment_event&quot;]))
    predictions.name = &quot;probability&quot;
    predictions = 1 - predictions
    predictions = test_data.merge(predictions, left_index=True, right_index=True)

    positive_predictions = predictions.query(&quot;probability &gt; @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts()
    negative_predictions = predictions.query(&quot;probability &lt;= @cutoff&quot;)[&quot;curtailment_event&quot;].value_counts()

    true_positives = positive_predictions.loc[True]
    false_positives = positive_predictions.loc[False]

    true_negatives = negative_predictions.loc[False]
    false_negatives = negative_predictions[True]

    accuracy = (true_positives+true_negatives)/len(predictions)
    precision = true_positives / (true_positives + false_positives)
    return {&quot;results&quot;: result, &quot;accuracy&quot;: accuracy, &quot;precision&quot;: precision}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model1 = []
for i in range(100):
    model1.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + load + t + dswrf&quot;, data, cutoff=.7))
results1 = pd.DataFrame(model1)
print(&quot;Accuracy : {}&quot;.format(results1[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results1[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.8873611111111112 Precision : 0.8489247311827957
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>model1[1][&quot;results&quot;].summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>   <td>['C(curtailment_event)[False]', 'C(curtailment_event)[True]']</td> <th>  No. Observations:  </th>  <td>   283</td>
</tr>
<tr>
  <th>Model:</th>                                        <td>GLM</td>                              <th>  Df Residuals:      </th>  <td>   275</td>
</tr>
<tr>
  <th>Model Family:</th>                              <td>Binomial</td>                            <th>  Df Model:          </th>  <td>     7</td>
</tr>
<tr>
  <th>Link Function:</th>                               <td>logit</td>                             <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                                      <td>IRLS</td>                              <th>  Log-Likelihood:    </th> <td> -68.257</td>
</tr>
<tr>
  <th>Date:</th>                                  <td>Thu, 30 Apr 2020</td>                        <th>  Deviance:          </th> <td>  136.51</td>
</tr>
<tr>
  <th>Time:</th>                                      <td>13:25:21</td>                            <th>  Pearson chi2:      </th>  <td>  212.</td>
</tr>
<tr>
  <th>No. Iterations:</th>                                <td>7</td>                               <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>                           <td>nonrobust</td>                           <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
               <td></td>                 <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>                  <td>  -57.6466</td> <td>   22.202</td> <td>   -2.596</td> <td> 0.009</td> <td> -101.162</td> <td>  -14.132</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.3]</th> <td>    1.1928</td> <td>    0.808</td> <td>    1.477</td> <td> 0.140</td> <td>   -0.390</td> <td>    2.776</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.4]</th> <td>    1.0888</td> <td>    0.993</td> <td>    1.097</td> <td> 0.273</td> <td>   -0.857</td> <td>    3.035</td>
</tr>
<tr>
  <th>C(timestamp.dt.month)[T.5]</th> <td>    0.9277</td> <td>    1.139</td> <td>    0.814</td> <td> 0.415</td> <td>   -1.305</td> <td>    3.160</td>
</tr>
<tr>
  <th>C(is_weekday)[T.True]</th>      <td>    1.2901</td> <td>    0.866</td> <td>    1.490</td> <td> 0.136</td> <td>   -0.407</td> <td>    2.987</td>
</tr>
<tr>
  <th>load</th>                       <td> 4.799e-06</td> <td> 1.14e-06</td> <td>    4.213</td> <td> 0.000</td> <td> 2.57e-06</td> <td> 7.03e-06</td>
</tr>
<tr>
  <th>t</th>                          <td>    0.1028</td> <td>    0.074</td> <td>    1.384</td> <td> 0.166</td> <td>   -0.043</td> <td>    0.248</td>
</tr>
<tr>
  <th>dswrf</th>                      <td>   -0.0069</td> <td>    0.003</td> <td>   -2.295</td> <td> 0.022</td> <td>   -0.013</td> <td>   -0.001</td>
</tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model2 = []
for i in range(100):
    model2.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + load&quot;, data, cutoff=.7))
results2 = pd.DataFrame(model2)
print(&quot;Accuracy : {}&quot;.format(results2[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results2[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.9038888888888887 Precision : 0.8506289308176099
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model3 = []
for i in range(100):
    model3.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + t * dswrf&quot;, data, cutoff=.8))
results3 = pd.DataFrame(model3)
print(&quot;Accuracy : {}&quot;.format(results3[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results3[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.8783333333333332 Precision : nan
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model4 = []
for i in range(100):
    model4.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + t + dswrf&quot;, data, cutoff=.7))
results4 = pd.DataFrame(model4)
print(&quot;Accuracy : {}&quot;.format(results4[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results4[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.8748611111111111 Precision : 0.15
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model5 = []
for i in range(100):
    model5.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + SUNSD&quot;, data, cutoff=.7))
results5 = pd.DataFrame(model5)
print(&quot;Accuracy : {}&quot;.format(results5[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results5[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.9001388888888888 Precision : nan
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Run this 100 times:
model_ = []
for i in range(100):
    model_.append(simulate(&quot;C(curtailment_event) ~ C(timestamp.dt.month) + C(is_weekday) + t&quot;, data, cutoff=.7))
results_ = pd.DataFrame(model_)
print(&quot;Accuracy : {}&quot;.format(results_[&quot;accuracy&quot;].mean()), &quot;Precision : {}&quot;.format(results_[&quot;precision&quot;].mean()))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/ttu/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/ipykernel_launcher.py:25: RuntimeWarning: invalid value encountered in long_scalars
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy : 0.8776388888888887 Precision : 0.0
</pre></div></div>
</div>
</div>
<div class="section" id="Visualize-Results">
<h1>Visualize Results<a class="headerlink" href="#Visualize-Results" title="Permalink to this headline">¶</a></h1>
<p>TODO:</p>
<ul class="simple">
<li><p>Histogram of probabilities on days where there is or isn’t a “substantial” curtailment event</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>model_[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;results&#39;: &lt;statsmodels.genmod.generalized_linear_model.GLMResultsWrapper at 0x7efcb07d8910&gt;,
 &#39;accuracy&#39;: 0.9166666666666666,
 &#39;precision&#39;: nan}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import altair as alt

alt.Chart()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">SchemaValidationError</span>                     Traceback (most recent call last)
<span class="ansi-green-fg">~/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/altair/vegalite/v4/api.py</span> in <span class="ansi-cyan-fg">to_dict</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    380</span>         <span class="ansi-green-fg">if</span> dct <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    381</span>             kwargs<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;validate&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;deep&#34;</span>
<span class="ansi-green-fg">--&gt; 382</span><span class="ansi-red-fg">             </span>dct <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span>TopLevelMixin<span class="ansi-blue-fg">,</span> copy<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>to_dict<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    383</span>
<span class="ansi-green-intense-fg ansi-bold">    384</span>         <span class="ansi-red-fg"># TODO: following entries are added after validation. Should they be validated?</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/CaReCur-b3qbtQ7S/lib/python3.7/site-packages/altair/utils/schemapi.py</span> in <span class="ansi-cyan-fg">to_dict</span><span class="ansi-blue-fg">(self, validate, ignore, context)</span>
<span class="ansi-green-intense-fg ansi-bold">    337</span>                 self<span class="ansi-blue-fg">.</span>validate<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    338</span>             <span class="ansi-green-fg">except</span> jsonschema<span class="ansi-blue-fg">.</span>ValidationError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 339</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> SchemaValidationError<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>         <span class="ansi-green-fg">return</span> result
<span class="ansi-green-intense-fg ansi-bold">    341</span>

<span class="ansi-red-fg">SchemaValidationError</span>: Invalid specification

        altair.vegalite.v4.api.Chart, validating &#39;required&#39;

        &#39;data&#39; is a required property

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
alt.Chart(...)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright Thomas Tu, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>